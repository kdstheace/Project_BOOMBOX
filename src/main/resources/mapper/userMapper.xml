<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boom.box.dao.UserMapper">

<insert id="insertUser" parameterType="user">
	<selectKey keyProperty="user_id" resultType="int" order="BEFORE">
		select
			user_seq.nextval
		from
			dual
	</selectKey>
	insert into user_tb(
	    user_id
	   ,user_name
	   ,user_googleId
	   ,user_googleImg
	   ,user_phone
	   ,user_address
	   ,user_zip
	   ,user_email
	   ,user_gender
	   ,user_bday
	)values(
		#{user_id}
	    ,#{user_name}
	    ,#{user_googleId}
	    ,#{user_googleImg}
	    ,#{user_phone}
	    ,#{user_address}
	    ,#{user_zip}
	    ,#{user_email}
	    ,#{user_gender}
	    ,#{user_bday}
	)
</insert>
	
<insert id="insertStage" parameterType="user">
	INSERT INTO 
		stage_tb (
			stage_id
			, stage_user_id
		)select
			stage_seq.nextval
			, A.* from(
			select
				#{user_id} as stage_user_id
			from
				dual
			) A
</insert>


<insert id="insertUserInterest" parameterType="user">
	insert into
		userInterest_tb(
			userInterest_id
			,userInterest_user_id
			,userInterest_interest
		)
		select
			userInterest_seq.nextval
			, A.* from(
		<foreach collection="userInterest_interest" item="arr" separator="UNION ALL ">
			select
				#{user_id} as userInterest_user_id
				,#{arr} as userInterest_interest
			from
				dual
		</foreach>
		) A
</insert>

<select id="selectUserOne" resultType="user">
	select
		user_name
	from
		user_tb
	where
		user_name = #{user_name}
</select>


<select id="selectUserEmail" resultType="user">
	select
		user_email
	from
		user_tb
	where
		user_email = #{user_email}
</select>

<select id="selectGoogleId" parameterType="string" resultType="user">
	select
		user_id
		,user_name
		,user_googleId
		,user_googleImg
		,user_phone
		,user_address
		,user_zip
		,user_email
		,user_gender
		,to_char(user_bday, 'yyyy-MM-dd') as user_bday
		,user_indate
		,user_manager
		,user_pending
	from
		user_tb
	where
		user_googleId = #{user_googleId}
</select>
	
<update id="updateInfo" parameterType="user">
	
UPDATE
	USER_TB
SET
	user_name = #{user_name},
	USER_ADDRESS = #{user_address},
	USER_ZIP = #{user_zip},
	USER_EMAIL = #{user_email}
WHERE
	user_id = #{user_id }
	
</update>

<delete id="deleteUserInterest" parameterType="user">

DELETE FROM 
	userInterest_tb
WHERE 
	userInterest_user_id = #{user_id }

</delete>	
	

</mapper>
